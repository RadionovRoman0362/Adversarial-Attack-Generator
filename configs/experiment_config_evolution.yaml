# configs/experiment_config_composite_evo.yaml
#
# Конфигурация для запуска эволюционного поиска композитных атак.
# Цель: найти наилучшую *структуру* и *параметры* градиентного метода
# для атаки на ансамбль защищенных и незащищенных моделей.
#
# Запуск: python scripts/run_search.py --config configs/experiment_config_composite_evo.yaml

# --- Параметры Поиска ---
search:
  sampler: "evolutionary"
  params:
    population_size: 20   # Размер популяции (больше = лучше исследование, но медленнее)
    mutation_rate: 0.8    # Высокая вероятность мутации, т.к. мы ищем новые структуры
    tournament_size: 3
    # Многоцелевая оптимизация: максимизировать ASR, минимизировать заметность (L2)
    objectives:
      - metric: "attack_success_rate"
        direction: "maximize"
      - metric: "avg_l2_norm"
        direction: "minimize"
    # Ограничение: не рассматриваем атаки, которые совсем не работают
    constraints:
      - metric: "attack_success_rate"
        type: "greater_than"
        threshold: 0.05
    # Стратегия мутации: основной упор на изменение структуры градиента
    mutation_strategy:
      - type: "structural"   # Мутация структуры (добавить/удалить/заменить декоратор)
        probability: 0.6
      - type: "parameter"     # Тонкая настройка параметров
        probability: 0.4

num_trials: 15          # Количество поколений для эволюции
num_eval_samples: 1000  # На скольких примерах оценивать каждую атаку
search_space_path: "configs/search_space.yaml"
results_dir: "./results_composite_evo" # Уникальная папка для результатов

# --- Параметры Атаки (общие для всех прогонов) ---
epsilon: 0.03137 # 8/255
steps: 40        # Увеличим число шагов для более сильных атак
norm: "linf"

# --- Модели для Атаки ---
# Первая модель (незащищенная) - суррогатная.
models:
  - model_name: "resnet18_imagenet"
    num_classes: 10
    checkpoint_path: "./checkpoints_imagenette/model_best.pth.tar"
  - model_name: "resnet18_imagenet"
    num_classes: 10
    checkpoint_path: "./checkpoints_imagenette_pgd7/model_best.pth.tar"
  - model_name: "resnet18_imagenet"
    num_classes: 10
    checkpoint_path: "./checkpoints_imagenette_trades/model_best.pth.tar"

# --- Датасет для Атаки ---
dataset:
  name: "imagenette"
  data_dir: "./data"
  batch_size: 32
  num_workers: 4